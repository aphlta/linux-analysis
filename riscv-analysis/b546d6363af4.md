commit b546d6363af4791567dcd145109837fe97cc8ba5
Author: Song Shuai <suagrfillet@gmail.com>
Date:   Thu Nov 30 13:15:28 2023 +0100

    riscv: select FTRACE_MCOUNT_USE_PATCHABLE_FUNCTION_ENTRY
    
    In commit afc76b8b8011 ("riscv: Using PATCHABLE_FUNCTION_ENTRY instead
    of MCOUNT") RISC-V added support for -fpatchable-function-entry, which
    removes the need for recordmcount.
    
    Select FTRACE_MCOUNT_USE_PATCHABLE_FUNCTION_ENTRY to tell the build
    system not to run recordmcount.
    
    Link: https://lore.kernel.org/linux-riscv/CAAYs2=j3Eak9vU6xbAw0zPuoh00rh8v5C2U3fePkokZFibWs2g@mail.gmail.com/T/#t
    Link: https://lore.kernel.org/linux-riscv/Y4jtfrJt+%2FQ5nMOz@spud/
    Signed-off-by: Song Shuai <suagrfillet@gmail.com>
    Tested-by: Guo Ren <guoren@kernel.org>
    Signed-off-by: Guo Ren <guoren@kernel.org>
    Acked-by: Björn Töpel <bjorn@rivosinc.com>
    Link: https://lore.kernel.org/r/20231130121531.1178502-2-bjorn@kernel.org
    Signed-off-by: Palmer Dabbelt <palmer@rivosinc.com>

diff --git a/arch/riscv/Kconfig b/arch/riscv/Kconfig
index 95a2a06acc6a..69c95e42be9f 100644
--- a/arch/riscv/Kconfig
+++ b/arch/riscv/Kconfig
@@ -68,6 +68,7 @@ config RISCV
 	select CPU_PM if CPU_IDLE || HIBERNATION
 	select EDAC_SUPPORT
 	select FRAME_POINTER if PERF_EVENTS || (FUNCTION_TRACER && !DYNAMIC_FTRACE)
+	select FTRACE_MCOUNT_USE_PATCHABLE_FUNCTION_ENTRY if DYNAMIC_FTRACE
 	select GENERIC_ARCH_TOPOLOGY
 	select GENERIC_ATOMIC64 if !64BIT
 	select GENERIC_CLOCKEVENTS_BROADCAST if SMP
